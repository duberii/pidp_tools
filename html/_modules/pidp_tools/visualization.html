<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pidp_tools.visualization &mdash; pidp_tools 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/documentation_options.js?v=8d563738"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pidp_tools
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <!-- Local TOC -->
              <div class="local-toc"></div>
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pidp_tools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pidp_tools.visualization</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pidp_tools.visualization</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span> 
<span class="kn">import</span> <span class="nn">plotly.express</span> <span class="k">as</span> <span class="nn">pxp</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">ipywidgets</span> <span class="kn">import</span> <span class="n">interactive</span><span class="p">,</span> <span class="n">HBox</span><span class="p">,</span> <span class="n">VBox</span><span class="p">,</span> <span class="n">Layout</span>
<span class="kn">import</span> <span class="nn">ipywidgets</span> <span class="k">as</span> <span class="nn">widgets</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">pidp_tools.analysis</span> <span class="kn">import</span> <span class="n">get_charge</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>

<div class="viewcode-block" id="plot_vector">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.plot_vector">[docs]</a>
<span class="k">def</span> <span class="nf">plot_vector</span><span class="p">(</span><span class="n">x_val</span><span class="p">,</span><span class="n">y_val</span><span class="p">,</span><span class="n">z_val</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Plots the vector with the supplied components.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  x_val \: float</span>
<span class="sd">      The x component of the vector to be plotted.</span>
<span class="sd">  y_val \: float</span>
<span class="sd">      The y component of the vector to be plotted.</span>
<span class="sd">  z_val \: float</span>
<span class="sd">      The z component of the vector to be plotted.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">x</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">x_val</span><span class="p">]</span>
  <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_val</span><span class="p">]</span>
  <span class="n">z</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">z_val</span><span class="p">]</span>
  <span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;scatter3d&quot;</span><span class="p">,</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">3</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Vector&quot;</span><span class="p">),</span><span class="n">go</span><span class="o">.</span><span class="n">Cone</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span><span class="n">u</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">v</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">w</span><span class="o">=</span><span class="p">[</span><span class="mf">0.3</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])],</span><span class="n">anchor</span><span class="o">=</span><span class="s2">&quot;tip&quot;</span><span class="p">,</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span><span class="n">colorscale</span><span class="o">=</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">]],</span><span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;markers&quot;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Origin&quot;</span><span class="p">)]</span>
  <span class="n">layout</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Layout</span><span class="p">(</span><span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">aspectmode</span><span class="o">=</span><span class="s2">&quot;cube&quot;</span><span class="p">,</span><span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]),</span><span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">]),</span><span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span><span class="mi">10</span><span class="p">])))</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">)</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="x_coord">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.x_coord">[docs]</a>
<span class="k">def</span> <span class="nf">x_coord</span><span class="p">(</span><span class="n">r_curvature</span><span class="p">,</span> <span class="n">theta_curvature</span><span class="p">,</span><span class="n">center_x</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Calculates the x coordinate of a track based on its radius of curvature, starting point, center of curvature, and charge after t radians.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  r_curvature \: float</span>
<span class="sd">      The radius of curvature of the track.</span>
<span class="sd">  theta_curvature \: float</span>
<span class="sd">      The phase offset of the track&#39;s parametrization. This is necessary to ensure the track starts at the origin.</span>
<span class="sd">  center_x \: float</span>
<span class="sd">      The x coordinate of the center of curvature of the track of the particle.</span>
<span class="sd">  t \: :external:func:`numpy.array`</span>
<span class="sd">      An array of angles along the track (in radians) to calculate the x coordinate of.</span>
<span class="sd">  q \: int</span>
<span class="sd">      The charge of the particle that left the track.</span>
<span class="sd">        </span>
<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  :external:func:`numpy.array`</span>
<span class="sd">      The x coordinates of the points along the track with angles provided in the t argument.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">r_curvature</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta_curvature</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">center_x</span></div>


<div class="viewcode-block" id="y_coord">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.y_coord">[docs]</a>
<span class="k">def</span> <span class="nf">y_coord</span><span class="p">(</span><span class="n">r_curvature</span><span class="p">,</span><span class="n">theta_curvature</span><span class="p">,</span><span class="n">center_y</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span><span class="n">q</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Calculates the y coordinate of a track based on its radius of curvature, starting point, center of curvature, and charge.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  r_curvature \: float</span>
<span class="sd">      The radius of curvature of the track.</span>
<span class="sd">  theta_curvature \: float</span>
<span class="sd">      The phase offset of the track&#39;s parametrization. This is necessary to ensure the track starts at the origin.</span>
<span class="sd">  center_y \: float</span>
<span class="sd">      The y coordinate of the center of curvature of the track of the particle.</span>
<span class="sd">  t \: :external:func:`numpy.array`</span>
<span class="sd">      An array of angles along the track (in radians) to calculate the y coordinate of.</span>
<span class="sd">  q \: int</span>
<span class="sd">      The charge of the particle that left the track.</span>
<span class="sd">        </span>
<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  :external:func:`numpy.array`</span>
<span class="sd">      The y coordinates of the points along the track with angles provided in the t argument.</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">r_curvature</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta_curvature</span><span class="o">-</span><span class="n">q</span><span class="o">*</span><span class="n">t</span><span class="p">)</span><span class="o">+</span> <span class="n">center_y</span></div>


<div class="viewcode-block" id="degrees_to_radians">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.degrees_to_radians">[docs]</a>
<span class="k">def</span> <span class="nf">degrees_to_radians</span><span class="p">(</span><span class="n">degrees</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Converts degrees to radians.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  degrees \: float or :external:func:`numpy.array`</span>
<span class="sd">      Angle (or array of angles) in degrees.</span>
<span class="sd">        </span>
<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  float or :external:func:`numpy.array`</span>
<span class="sd">      Angle (or array of angles) in radians.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">return</span> <span class="n">degrees</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">180</span></div>


<div class="viewcode-block" id="wirePositions">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.wirePositions">[docs]</a>
<span class="k">class</span> <span class="nc">wirePositions</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  An object that stores a variety of properties of the straws of the GlueX Central Drift Chamber (CDC).</span>

<span class="sd">  Attributes</span>
<span class="sd">  -----------</span>
<span class="sd">  wire_positions_df \: :external:class:`pandas.DataFrame`</span>
<span class="sd">      A pandas dataframe with at least the following three columns:</span>

<span class="sd">      - &quot;pos&quot; \: contains a list with two elements, each of which is a position vector. The first position vector is the position of the straw at the upstream end of the detector (z=s=0). The second position vector is the position of the straw at the downstream end of the detector (z=175, s=1). Positions in between can be expressed as a convex combination of the two vectors based on the normalized z coordinate.</span>
<span class="sd">      - &quot;ring&quot; \: The ring the straw in question belongs to</span>
<span class="sd">      - &quot;straw&quot; \: The straw in question</span>
<span class="sd">  positionsMatrix \: list</span>
<span class="sd">      A 3D jagged array of wire positions. The first index of the array represents the ring, and the second index represents the straw number. The third index represents the end of the detector (index 0 is upstream, index 1 is downstream). The fourth index represents the coordinate of the position of the straw in question (index 0 is x, index 1 is y, and index 2 is z).</span>
<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="s2">&quot;wget&quot;</span><span class="p">,</span> <span class="s2">&quot;-q&quot;</span><span class="p">,</span> <span class="s2">&quot;-O&quot;</span><span class="p">,</span> <span class="s2">&quot;CentralDC_HDDS.xml&quot;</span><span class="p">,</span> <span class="s2">&quot;https://github.com/JeffersonLab/hdds/raw/master/CentralDC_HDDS.xml&quot;</span><span class="p">])</span>
    <span class="n">tree</span> <span class="o">=</span><span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;CentralDC_HDDS.xml&quot;</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="n">n_wires_per_ring</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">positionsMatrix</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ar</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">tag</span> <span class="ow">in</span> <span class="p">[</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="s2">&quot;composition&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">j</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">)</span><span class="o">==</span><span class="s2">&quot;CDClayers&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]:</span>
      <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s2">&quot;mposPhi&quot;</span><span class="p">:</span>
        <span class="n">positionsMatrix</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">n_wires_per_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ncopy&#39;</span><span class="p">)))</span>
        <span class="n">R_Z</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;R_Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">Phi0</span> <span class="o">=</span> <span class="n">degrees_to_radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Phi0&quot;</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;CDCstrawShort&#39;</span><span class="p">:</span>
          <span class="n">dPhi</span> <span class="o">=</span> <span class="n">degrees_to_radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;dPhi&quot;</span><span class="p">)))</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ncopy&quot;</span><span class="p">))):</span>
            <span class="n">ar</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;pos&#39;</span><span class="p">:[[</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="mi">150</span><span class="p">]],</span><span class="s1">&#39;ring&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ring&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)),</span><span class="s1">&#39;straw&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span>
            <span class="n">positionsMatrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;volume&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;CDCstrawLong&#39;</span><span class="p">:</span>
          <span class="n">n_wires_per_ring</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ncopy&#39;</span><span class="p">)))</span>
          <span class="n">dPhi</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ncopy&quot;</span><span class="p">))</span>
          <span class="n">rot</span> <span class="o">=</span> <span class="n">degrees_to_radians</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;rot&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span>
          <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ncopy&quot;</span><span class="p">))):</span>
            <span class="n">ar</span><span class="o">.</span><span class="n">append</span><span class="p">({</span><span class="s1">&#39;pos&#39;</span><span class="p">:[[</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">)</span><span class="o">+</span><span class="mi">75</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">)</span><span class="o">-</span><span class="mi">75</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="mi">0</span><span class="p">],[</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">)</span><span class="o">-</span><span class="mi">75</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="n">R_Z</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">)</span><span class="o">+</span><span class="mi">75</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Phi0</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">dPhi</span><span class="p">),</span><span class="mi">150</span><span class="p">]],</span><span class="s1">&#39;ring&#39;</span><span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">tag</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;ring&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">)),</span><span class="s1">&#39;straw&#39;</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">})</span>
            <span class="n">positionsMatrix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ar</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;pos&#39;</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">wire_positions_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">ar</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span> <span class="o">=</span> <span class="n">positionsMatrix</span>
<div class="viewcode-block" id="wirePositions.position">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.wirePositions.position">[docs]</a>
  <span class="k">def</span> <span class="nf">position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rings</span><span class="p">,</span> <span class="n">wires</span><span class="p">,</span><span class="n">s</span><span class="p">,</span> <span class="n">dataframe</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the wire position.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ------------</span>
<span class="sd">    rings \: list</span>
<span class="sd">        A list of rings that represent the rings in which the wires provided are located.</span>
<span class="sd">    wires \: list</span>
<span class="sd">        A list of wires whose positions will be calculated.</span>
<span class="sd">    s \: float or list</span>
<span class="sd">        A number (or list of numbers) that represents a normalized z coordinate (z/175) of the wire. This is used because several wires are slanted, so their x and y coordinates depend on the z coordinate. If s is a float or int, all wire positions will be calculated with this same normalized z coordinate.</span>
<span class="sd">    t \: :external:func:`numpy.array`</span>
<span class="sd">      An array of angles along the track (in radians) to calculate the x coordinate of</span>
<span class="sd">    dataframe \: bool, default False</span>
<span class="sd">      Return a dataframe containing the x and y coordinates of the wires. If True, the coordinates will be returned in a dataframe with four columns\: &quot;ring&quot;, &quot;wire&quot;, &quot;x&quot;, and &quot;y&quot;.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    ---------</span>
<span class="sd">    :external:func:`numpy.array` or :external:class:`pandas.DataFrame`</span>
<span class="sd">        An array or dataframe containing the x and y coordinates of the wires at the given normalized z coordinate(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">dataframe</span><span class="p">:</span>
      <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
      <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rings</span>
      <span class="n">df</span><span class="p">[</span><span class="s1">&#39;wire&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wires</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))]</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))]</span>
      <span class="k">return</span> <span class="n">df</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))])</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">+</span> <span class="n">s</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">new_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))])</span>
        <span class="n">new_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span><span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="nb">int</span><span class="p">(</span><span class="n">wires</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wires</span><span class="p">))])</span>
      <span class="k">return</span> <span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span></div>
</div>


<div class="viewcode-block" id="track_fitting">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting">[docs]</a>
<span class="k">class</span> <span class="nc">track_fitting</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates a track fitting applet with hits drawn based on the provided event.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  title \: str, default &quot;Hits in the GlueX CDC&quot;</span>
<span class="sd">      The title of the plot.</span>
<span class="sd">  wire_positions \: :class:`wirePositions`, default None</span>
<span class="sd">      A wirePositions object to reference detector coordinates. By default, one will be created. However, if you wish to avoid creating multiple instances, you can provide one that is already created.</span>
<span class="sd">  event \: :external:class:`pandas.DataFrame`, default None</span>
<span class="sd">      A row of a dataframe with the following columns:</span>

<span class="sd">      - &quot;px&quot; \: The x component of the momentum of the generated particle.</span>
<span class="sd">      - &quot;py&quot; \: The y component of the momentum of the generated particle.</span>
<span class="sd">      - &quot;pz&quot; \: The z component of the momentum of the generated particle.</span>
<span class="sd">      - &quot;vz&quot; \: The z coordinate of the vertex (&quot;creation point&quot;) of the generated particle.</span>
<span class="sd">      - &quot;ring&quot; \: A list of rings that contain hits.</span>
<span class="sd">      - &quot;straw&quot; \: A list of straws that contain hits.</span>
<span class="sd">  showTrack \: bool, default False</span>
<span class="sd">      Draws the track. If True, a track will be drawn in red.</span>
<span class="sd">  showlegend \: bool, default False</span>
<span class="sd">      Displays a legend. If True, a legend will be drawn to the right of the applet.</span>
<span class="sd">        </span>
<span class="sd">  Attributes</span>
<span class="sd">  ----------</span>
<span class="sd">  figure \: :external:class:`plotly.graph_objects.Figure`</span>
<span class="sd">      A plotly FigureWidget that contains the applet.</span>
<span class="sd">  px \: float</span>
<span class="sd">      The x component of the momentum of the generated particle.</span>
<span class="sd">  py \: float</span>
<span class="sd">      The y component of the momentum of the generated particle.</span>
<span class="sd">  pz \: float</span>
<span class="sd">      The z component of the momentum of the generated particle.</span>
<span class="sd">  current_px \: float</span>
<span class="sd">      The x component of the momentum, as determined by the current state of any available sliders.</span>
<span class="sd">  current_py \: float</span>
<span class="sd">      The y component of the momentum, as determined by the current state of any available sliders.</span>
<span class="sd">  current_pz \: float</span>
<span class="sd">      The z component of the momentum, as determined by the current state of any available sliders.</span>
<span class="sd">  current_z0 \: float</span>
<span class="sd">      The z coordinate of the vertex (&quot;creation point&quot;), as determined by the current state of any available sliders.</span>
<span class="sd">  current_charge \: int or float</span>
<span class="sd">      The charge, as determined by the current state of any available sliders.</span>
<span class="sd">  ring \: list</span>
<span class="sd">      A list of rings that contain hits.</span>
<span class="sd">  straw \: list</span>
<span class="sd">      A list of straws that contain hits.</span>
<span class="sd">  vz \: float</span>
<span class="sd">      The z coordinate of the vertex (&quot;creation point&quot;) of the generated particle.</span>
<span class="sd">  wirePositions \: :class:`wirePositions`</span>
<span class="sd">      A wirePositions object that contains information about the GlueX CDC.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Hits in the GlueX CDC&quot;</span><span class="p">,</span> <span class="n">wire_positions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">event</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showTrack</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">wire_positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span> <span class="o">=</span> <span class="n">wirePositions</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span> <span class="o">=</span> <span class="n">wire_positions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">yaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="n">showlegend</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=-</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">y0</span><span class="o">=-</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=-</span><span class="mi">55</span><span class="p">,</span> <span class="n">y0</span><span class="o">=-</span><span class="mi">55</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">event</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">charge</span> <span class="o">=</span> <span class="n">get_charge</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;particle&quot;</span><span class="p">])</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;px&#39;</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;py&#39;</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pz</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;pz&#39;</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vz</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;vz&#39;</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">straw</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;straw&#39;</span><span class="p">]</span>
      <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">straw</span><span class="p">,</span><span class="mi">75</span><span class="p">,</span><span class="n">dataframe</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span><span class="n">y</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Ring: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Wire: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;wire&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">],</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">})</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">px</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">pz</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">vz</span> <span class="o">=</span> <span class="mf">0.</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">ring</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">straw</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_px</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_py</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_pz</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_z0</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_charge</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">showTrack</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;track&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">})</span>
<div class="viewcode-block" id="track_fitting.show">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.show">[docs]</a>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the track fitting applet. This is a wrapper method for `plotly.graph_objects.Figure.show &lt;https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html#plotly.graph_objects.Figure.show&gt;`_.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="track_fitting.update_layout">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.update_layout">[docs]</a>
  <span class="k">def</span> <span class="nf">update_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the layout of the applet. This is a wrapper method for :external:meth:`plotly.graph_objects.Figure.update_layout`. Refer to its documentation for a list of all possible arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="track_fitting.update">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.update">[docs]</a>
  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the applet. This is a wrapper method for :external:meth:`plotly.graph_objects.Figure.update`. Refer to its documentation for a list of all possible arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="track_fitting.display">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.display">[docs]</a>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays the sliders corresponding to track parameters. This is done by calling the :meth:`track_fitting.update_figure` method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    \*\*kwargs:</span>
<span class="sd">        The following keyword arguments correspond to the arguments of the :meth:`track_fitting.update_figure` method. Each of these keyword arguments should be used for every call. Each of these keyword arguments can be assigned one of the following:</span>

<span class="sd">        - A tuple of the form `(min_value, max_value, step)` for numerical (float/int) arguments, which will generate a slider for the argument in question.</span>
<span class="sd">        - A boolean for boolean arguments, which will generate a checkbox, which allows the user to toggle the argument.</span>
<span class="sd">        - A list of strings or tuples, which will produce a dropdown menu of the provided options. If strings, the values in the dropdown will be passed directly to the :meth:`track_fitting.update_figure` method. If a list of tuples is passed, they should be of the form (label, value), where the dropdown options are the &quot;labels&quot;, and the corresponding value to be passed to :meth:`track_fitting.update_figure` is the &quot;value&quot;.</span>
<span class="sd">        - An instance of `ipywidgets.widgets.interaction.fixed &lt;https://ipywidgets.readthedocs.io/en/stable/reference/ipywidgets.html#ipywidgets.widgets.interaction.fixed&gt;`_, which represents that the provided value cannot be changed by the user. No widget will be generated for this argument.</span>
<span class="sd">          </span>
<span class="sd">        The below list of keyword arguments specifies the expected type of the arguments.</span>
<span class="sd">        </span>
<span class="sd">            px \: int or float</span>
<span class="sd">                The x component of the momentum of the track.</span>
<span class="sd">            py \: int or float</span>
<span class="sd">                The y component of the momentum of the track.</span>
<span class="sd">            pz \: int or float</span>
<span class="sd">                The z component of the momentum of the track.</span>
<span class="sd">            z0 \: int or float</span>
<span class="sd">                The z coordinate of the vertex that produced the track. In other words, this is the z component of the &quot;starting point&quot; of the track.</span>
<span class="sd">            charge \: int or float</span>
<span class="sd">                The charge of the track. This can be a float, but it should usually be -1 or 1.</span>
<span class="sd">            t_max \: int or float</span>
<span class="sd">                The length of the track to draw, measured in radians.</span>
<span class="sd">            show_track \: bool</span>
<span class="sd">                Draws the track. If True, draws the track with the supplied parameters.</span>
<span class="sd">            show_hits \: bool</span>
<span class="sd">                Draws the hits. If true, draws the hits detailed in the event passed during initialization.</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    -----------</span>
<span class="sd">    &gt;&gt;&gt; fig = track_fitting()</span>
<span class="sd">    &gt;&gt;&gt; fig.update()</span>
<span class="sd">    &gt;&gt;&gt; fig.display(px=(-1,1,0.0001),py=(-1,1,0.0001),t_max=(0,2*np.pi,0.0001),charge = (-1,1,2),show_track=fixed(True),show_hits=fixed(False),pz=fixed(0),z0=fixed(75))</span>

<span class="sd">    The result of this code is a track fitting applet with 4 sliders\: px, py, t_max, and charge. The remaining arguments are fixed, and will not correspond to a displayed widget.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widget</span><span class="o">=</span><span class="n">interactive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fig</span><span class="o">.</span><span class="n">update_figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">controls</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">children</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">flex_flow</span><span class="o">=</span><span class="s1">&#39;row wrap&#39;</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">VBox</span><span class="p">([</span><span class="n">controls</span><span class="p">,</span> <span class="n">output</span><span class="p">]))</span></div>

<div class="viewcode-block" id="track_fitting.update_figure">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.update_figure">[docs]</a>
  <span class="k">def</span> <span class="nf">update_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">z0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">px</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">charge</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">pz</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">t_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">show_track</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">show_hits</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates and draws the figure, recalculating the positions of the hits and the track trajectory, based on the provided track parameters.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    px \: float, default 0</span>
<span class="sd">        The x component of the momentum of the track.</span>
<span class="sd">    py \: float, default 0</span>
<span class="sd">        The y component of the momentum of the track.</span>
<span class="sd">    pz \: float, default 0</span>
<span class="sd">        The z component of the momentum of the track.</span>
<span class="sd">    z0 \: float, default 0</span>
<span class="sd">        The z coordinate of the vertex that produced the track. In other words, this is the z component of the &quot;starting point&quot; of the track.</span>
<span class="sd">    charge \: float or int, default 1</span>
<span class="sd">        The charge of the track. This can be a float, but it should usually be -1 or 1.</span>
<span class="sd">    t_max \: float, default 3.14</span>
<span class="sd">        The length of the track to draw, measured in radians.</span>
<span class="sd">    show_track \: bool, default True</span>
<span class="sd">        Draws the track. If True, draws the track with the supplied parameters.</span>
<span class="sd">    show_hits \: bool, default True</span>
<span class="sd">        Draws the hits. If true, draws the hits detailed in the event passed during initialization.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_px</span> <span class="o">=</span> <span class="n">px</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_py</span> <span class="o">=</span> <span class="n">py</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_pz</span> <span class="o">=</span> <span class="n">pz</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_z0</span> <span class="o">=</span> <span class="n">z0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">current_charge</span> <span class="o">=</span> <span class="n">charge</span>

    <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_px</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_py</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_pz</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">z_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">pz</span><span class="o">/</span><span class="n">p</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="n">z_angle</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">center_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_charge</span><span class="o">*</span><span class="mi">330</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">current_py</span><span class="o">/</span><span class="mf">1.7</span>
    <span class="n">center_y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">current_charge</span><span class="o">*</span><span class="mi">330</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">current_px</span><span class="o">/</span><span class="mf">1.7</span>
    <span class="n">r_curvature</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">center_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">theta_curvature</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">center_y</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">center_x</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">show_hits</span><span class="p">:</span>
      <span class="n">new_x</span><span class="p">,</span><span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">straw</span><span class="p">,</span><span class="n">z0</span><span class="o">/</span><span class="mi">175</span><span class="p">)</span>
      <span class="n">theta_hits</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">new_y</span><span class="o">-</span><span class="n">center_y</span><span class="p">,</span><span class="n">new_x</span><span class="o">-</span><span class="n">center_x</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">theta_hits</span><span class="p">)):</span>
        <span class="n">theta_hits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-=</span> <span class="n">theta_curvature</span>
        <span class="n">theta_hits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">theta_hits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">charge</span>
        <span class="k">if</span> <span class="n">theta_hits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
          <span class="n">theta_hits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">)):</span>
        <span class="n">new_x</span><span class="p">,</span><span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">straw</span><span class="p">,[(</span><span class="n">z0</span> <span class="o">+</span><span class="n">r_curvature</span><span class="o">*</span><span class="n">theta_hits</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">tan</span><span class="p">(</span><span class="n">z_angle</span><span class="p">))</span><span class="o">/</span><span class="mi">175</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">))])</span>
    <span class="k">if</span> <span class="n">show_track</span><span class="p">:</span>
      <span class="n">t_curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">t_max</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
      <span class="n">x_track</span> <span class="o">=</span> <span class="n">x_coord</span><span class="p">(</span><span class="n">r_curvature</span><span class="p">,</span><span class="n">theta_curvature</span><span class="p">,</span><span class="n">center_x</span><span class="p">,</span><span class="n">t_curve</span><span class="p">,</span><span class="n">charge</span><span class="p">)</span>
      <span class="n">y_track</span> <span class="o">=</span> <span class="n">y_coord</span><span class="p">(</span><span class="n">r_curvature</span><span class="p">,</span><span class="n">theta_curvature</span><span class="p">,</span><span class="n">center_y</span><span class="p">,</span><span class="n">t_curve</span><span class="p">,</span><span class="n">charge</span><span class="p">)</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">show_track</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">x_track</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">y_track</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">show_hits</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">new_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">new_y</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="track_fitting.distance_to_curve">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.distance_to_curve">[docs]</a>
  <span class="k">def</span> <span class="nf">distance_to_curve</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the distance between a point and the &quot;correct&quot; track. Used to find RMSE by varying the z coordinate of the vertex.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    x \: float</span>
<span class="sd">        The x coordinate of the point.</span>
<span class="sd">    y \: float</span>
<span class="sd">        The y coordinate of the point.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    distance_to_nearest_curve_point \: float</span>
<span class="sd">        The distance between the supplied point and the &quot;correct&quot; track, as determined by the parameters provided by the event.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">center_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="o">*</span><span class="mi">330</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">py</span><span class="o">/</span><span class="mf">1.7</span>
    <span class="n">center_y</span> <span class="o">=</span> <span class="o">-</span><span class="mi">330</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">px</span><span class="o">/</span><span class="mf">1.7</span>
    <span class="n">r_curvature</span> <span class="o">=</span> <span class="p">(</span><span class="n">center_x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">center_y</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">distance_to_nearest_curve_point</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">r_curvature</span><span class="o">-</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">center_x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">center_y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">distance_to_nearest_curve_point</span></div>

  
<div class="viewcode-block" id="track_fitting.calculate_rmse">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.calculate_rmse">[docs]</a>
  <span class="k">def</span> <span class="nf">calculate_rmse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x_points</span><span class="p">,</span> <span class="n">y_points</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the RMSE of the distance between the points and the &quot;correct&quot; track. This is used to optimize the z coordinate of the vertex.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    x_points \: list</span>
<span class="sd">        A list of x coordinates of hits in the CDC.</span>
<span class="sd">    y_points \: list</span>
<span class="sd">        A list of y coordinates of hits in the CDC.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    rmse \: float</span>
<span class="sd">        The root mean square error (RMSE) of the distances of the hits to the &quot;correct&quot; track.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mse</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">distance_to_curve</span><span class="p">(</span><span class="n">x_points</span><span class="p">[</span><span class="n">j</span><span class="p">],</span><span class="n">y_points</span><span class="p">[</span><span class="n">j</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_points</span><span class="p">))])</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">x_points</span><span class="p">)</span>
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">mse</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="k">return</span> <span class="n">rmse</span></div>

  
<div class="viewcode-block" id="track_fitting.calc_z0">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.calc_z0">[docs]</a>
  <span class="k">def</span> <span class="nf">calc_z0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Finds the most likely z coordinate of the vertex by minimizing the RMSE of the hit positions.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    quiet \: bool, default False</span>
<span class="sd">        Suppresses printing of z coordinate. If True, the correct z0 is simply returned and not printed.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    rmse \: float</span>
<span class="sd">        The root mean square error (RMSE) of the distances of the hits to the &quot;correct&quot; track. Only returned if `quiet` is True.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">rmses</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">z</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">150</span><span class="p">,</span><span class="mi">151</span><span class="p">):</span>
      <span class="n">new_x</span><span class="p">,</span> <span class="n">new_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">position</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ring</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">straw</span><span class="p">,</span><span class="n">z</span><span class="o">/</span><span class="mi">175</span><span class="p">)</span>
      <span class="n">rmses</span><span class="p">[</span><span class="n">z</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_rmse</span><span class="p">(</span><span class="n">new_x</span><span class="p">,</span><span class="n">new_y</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">quiet</span><span class="p">:</span>
      <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">rmses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">rmses</span><span class="o">.</span><span class="n">get</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The true z value is about &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">rmses</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">rmses</span><span class="o">.</span><span class="n">get</span><span class="p">)))</span></div>


<div class="viewcode-block" id="track_fitting.show_answer">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.track_fitting.show_answer">[docs]</a>
  <span class="k">def</span> <span class="nf">show_answer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">px</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">py</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">pz</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">z0</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints the track parameters, as determined by the GlueX reconstruction algorithm. The z coordinate of the vertex is the one exception, as this is calculated by minimizing RMSE.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    charge \: bool, default True</span>
<span class="sd">        Prints the charge of the particle. If True, the charge of the particle is printed</span>
<span class="sd">    px \: bool, default True</span>
<span class="sd">        Prints the x component of the momentum of the track. If True, the x component of momentum is printed.</span>
<span class="sd">    py \: bool, default True</span>
<span class="sd">        Prints the y component of the momentum of the track. If True, the y component of momentum is printed.</span>
<span class="sd">    pz \: bool, default False</span>
<span class="sd">        Prints the z component of the momentum of the track. If True, the y component of momentum is printed.</span>
<span class="sd">    z0 \: bool, default False</span>
<span class="sd">        Prints the z component of the vertex of the track. If True, the z component of the track vertex is printed.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">z0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">calc_z0</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">charge</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The charge of the particle is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">charge</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">px</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The x component of momentum is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">px</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">py</span> <span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The y component of momentum is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">py</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">pz</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The z component of momentum is &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pz</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span></div>

  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">():</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="CDC_plot_2D">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_2D">[docs]</a>
<span class="k">class</span> <span class="nc">CDC_plot_2D</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates a 2D model of the straws of the CDC.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  -----------</span>
<span class="sd">  rings \: list</span>
<span class="sd">      A list of rings to plot. All straws from the selected ring will be drawn. Each ring should be an integer between 1 and 28.</span>
<span class="sd">  title \: str, default &quot;Wire Positions in the GlueX CDC&quot;</span>
<span class="sd">      The title of the figure.</span>
<span class="sd">  wire_positions \: :meth:`wirePositions`, default None</span>
<span class="sd">      A :meth:`wirePositions` object to reference detector coordinates. By default, one will be created. However, if you wish to avoid creating multiple instances, you can provide one that is already created.</span>
<span class="sd">  showlegend \: bool, default True</span>
<span class="sd">      Displays a legend to the right of the model. If True, displays the legend.</span>

<span class="sd">  Attributes:</span>
<span class="sd">  -----------</span>
<span class="sd">  figure \: :external:class:`plotly.graph_objects.Figure`</span>
<span class="sd">      A plotly figure that displays the requested rings of the GlueX CDC.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rings</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Wire Positions in the GlueX CDC&quot;</span><span class="p">,</span> <span class="n">wire_positions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">wire_positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span> <span class="o">=</span> <span class="n">wirePositions</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span> <span class="o">=</span> <span class="n">wire_positions</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span> <span class="n">yaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="n">showlegend</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=-</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">y0</span><span class="o">=-</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mf">10.5</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=-</span><span class="mi">55</span><span class="p">,</span> <span class="n">y0</span><span class="o">=-</span><span class="mi">55</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">55</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">ring</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ring &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ring</span><span class="p">),</span><span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span><span class="mi">3</span><span class="p">},</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="n">text</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Ring: &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> Wire: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">ring</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]))])</span>
  
<div class="viewcode-block" id="CDC_plot_2D.show">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_2D.show">[docs]</a>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the CDC plot track fitting applet. This is a wrapper method for `plotly.graph_objects.Figure.show &lt;https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html#plotly.graph_objects.Figure.show&gt;`_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

  
<div class="viewcode-block" id="CDC_plot_2D.update_layout">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_2D.update_layout">[docs]</a>
  <span class="k">def</span> <span class="nf">update_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the layout of the applet. This is a wrapper method for :external:meth:`plotly.graph_objects.Figure.update_layout`. Refer to its documentation for a list of all possible arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

  
<div class="viewcode-block" id="CDC_plot_2D.update">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_2D.update">[docs]</a>
  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the applet. This is a wrapper method for :external:meth:`plotly.graph_objects.Figure.update`. Refer to its documentation for a list of all possible arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="CDC_plot_2D.display">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_2D.display">[docs]</a>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays the 2D CDC plot. This is done by calling the :meth:`CDC_plot_2D.update_figure` method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    \*\*kwargs:</span>
<span class="sd">        The following keyword arguments correspond to the arguments of the :meth:`track_fitting.update_figure` method. Each of these keyword arguments should be used for every call. Each of these keyword arguments can be assigned one of the following:</span>

<span class="sd">        - A tuple of the form &quot;(min_value, max_value, step)&quot; for numerical (float/int) arguments, which will generate a slider for the argument in question.</span>
<span class="sd">        - A boolean for boolean arguments, which will generate a checkbox, which allows the user to toggle the argument.</span>
<span class="sd">        - A list of strings or tuples, which will produce a dropdown menu of the provided options. If strings, the values in the dropdown will be passed directly to the :meth:`CDC_plot_2D.update_figure` method. If a list of tuples is passed, they should be of the form (label, value), where the dropdown options are the &quot;labels&quot;, and the corresponding value to be passed to :meth:`CDC_plot_2D.update_figure` is the &quot;value&quot;.</span>
<span class="sd">        - An instance of `ipywidgets.widgets.interaction.fixed &lt;https://ipywidgets.readthedocs.io/en/stable/reference/ipywidgets.html#ipywidgets.widgets.interaction.fixed&gt;`_, which represents that the provided value cannot be changed by the user. No widget will be generated for this argument.</span>
<span class="sd">  </span>
<span class="sd">        The below list of keyword arguments specifies the expected type of the arguments.</span>
<span class="sd">        </span>
<span class="sd">        z \: float or int</span>
<span class="sd">            The z coordinate of the slice of the CDC you want to look at. Should be between 0 and 175 (this quantity is assumed to be in cm).</span>
<span class="sd">        rings \: list</span>
<span class="sd">            A list of rings to be displayed. Each of the elements of this list should be an int, and should be between 1 and 28.</span>
<span class="sd">    </span>
<span class="sd">    Examples:</span>
<span class="sd">    -----------</span>
<span class="sd">    &gt;&gt;&gt; fig = CDC_plot_2D()</span>
<span class="sd">    &gt;&gt;&gt; fig.update()</span>
<span class="sd">    &gt;&gt;&gt; fig.display(z=(0,175,0.1), rings=fixed([1,2,3]))</span>

<span class="sd">    The result of this code is a plot with a slider that allows the user to look at different z-slices of the CDC. The rings shown are fixed.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widget</span><span class="o">=</span><span class="n">interactive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">controls</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">children</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">flex_flow</span><span class="o">=</span><span class="s1">&#39;row wrap&#39;</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">VBox</span><span class="p">([</span><span class="n">controls</span><span class="p">,</span> <span class="n">output</span><span class="p">]))</span></div>


<div class="viewcode-block" id="CDC_plot_2D.update_figure">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_2D.update_figure">[docs]</a>
  <span class="k">def</span> <span class="nf">update_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">rings</span><span class="o">=</span><span class="p">[]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates and draws the figure, recalculating the positions of the straws based on the provided z coordinate.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    z \: numerical</span>
<span class="sd">        The z coordinate of the slice of the CDC you want to look at. Should be between 0 and 175 (this quantity is assumed to be in cm).</span>
<span class="sd">    rings \: list</span>
<span class="sd">        A list of rings to be displayed. Each of the elements of this list should be an int, and should be between 1 and 28.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">s</span><span class="o">=</span> <span class="n">z</span><span class="o">/</span><span class="mi">175</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rings</span><span class="p">)):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">wire</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">wire</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">wire</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="p">[(</span><span class="mi">1</span><span class="o">-</span><span class="n">s</span><span class="p">)</span><span class="o">*</span><span class="n">wire</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span> <span class="n">s</span><span class="o">*</span><span class="n">wire</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">wire</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">positionsMatrix</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">rings</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="CDC_plot_3D">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.CDC_plot_3D">[docs]</a>
<span class="k">class</span> <span class="nc">CDC_plot_3D</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates and displays a 3D model of the straws of the CDC.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  -----------</span>
<span class="sd">  rings \: list</span>
<span class="sd">      A list of rings to plot. All straws from the selected ring will be drawn. Each ring should be an integer between 1 and 28. Can supply at most 3 rings.</span>
<span class="sd">  wire_positions \: :class:`wirePositions`, default None</span>
<span class="sd">      A wirePositions object to reference detector coordinates. By default, one will be created. However, if you wish to avoid creating multiple instances, you can provide one that is already created.</span>

<span class="sd">  Attributes:</span>
<span class="sd">  -----------</span>
<span class="sd">  figure \: :external:class:`plotly.graph_objects.Figure`</span>
<span class="sd">      A plotly figure that displays the requested rings of the GlueX CDC.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rings</span><span class="p">,</span> <span class="n">wire_positions</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">wire_positions</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span> <span class="o">=</span> <span class="n">wirePositions</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span> <span class="o">=</span> <span class="n">wire_positions</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rings</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Too many rings. Provide at most 3 rings.&quot;</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">zs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ring_wires</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">rings_to_plot</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">wirePositions</span><span class="o">.</span><span class="n">wire_positions_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">i</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">rings</span><span class="p">:</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">zs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;pos&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">ring_wires</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ring: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; Wire: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;straw&#39;</span><span class="p">]))</span>
        <span class="n">ring_wires</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Ring: &quot;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; Wire: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;straw&#39;</span><span class="p">]))</span>
        <span class="n">rings_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">])</span>
        <span class="n">rings_to_plot</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">])</span>
    <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">data_to_plot</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">xs</span>
    <span class="n">data_to_plot</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ys</span>
    <span class="n">data_to_plot</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">zs</span>
    <span class="n">data_to_plot</span><span class="p">[</span><span class="s1">&#39;Ring and Wire&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">ring_wires</span>
    <span class="n">data_to_plot</span><span class="p">[</span><span class="s1">&#39;ring&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">rings_to_plot</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">pxp</span><span class="o">.</span><span class="n">line_3d</span><span class="p">(</span><span class="n">data_frame</span><span class="o">=</span><span class="n">data_to_plot</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">line_group</span><span class="o">=</span><span class="s1">&#39;Ring and Wire&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;ring&#39;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_traces</span><span class="p">(</span><span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rings of the GlueX Central Drift Chamber&quot;</span><span class="p">,</span><span class="n">legend_title</span><span class="o">=</span><span class="s2">&quot;Ring Number&quot;</span><span class="p">,</span><span class="n">scene</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;aspectmode&#39;</span><span class="p">:</span><span class="s1">&#39;cube&#39;</span><span class="p">,</span><span class="s1">&#39;xaxis&#39;</span><span class="p">:{</span><span class="s1">&#39;range&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;X&quot;</span><span class="p">},</span><span class="s1">&#39;yaxis&#39;</span><span class="p">:{</span><span class="s1">&#39;range&#39;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="mi">175</span><span class="p">],</span><span class="s2">&quot;title&quot;</span><span class="p">:</span><span class="s2">&quot;Z&quot;</span><span class="p">},</span><span class="s1">&#39;zaxis&#39;</span><span class="p">:{</span><span class="s1">&#39;range&#39;</span><span class="p">:[</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span><span class="mi">60</span><span class="p">],</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="s1">&#39;Y&#39;</span><span class="p">}})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;&quot;</span></div>


<div class="viewcode-block" id="interactive_image">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.interactive_image">[docs]</a>
<span class="k">class</span> <span class="nc">interactive_image</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates an interactive image that can be used to find exponential cuts in 2D histograms.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  image_path \: str, default &quot;&quot;</span>
<span class="sd">      The path to the saved ROOT canvas.</span>
<span class="sd">  x_max \: float, default 1.</span>
<span class="sd">      The maximum of the x axis, which is typically used for momentum. This should be in the same units as were used when creating the ROOT histogram.</span>
<span class="sd">  y_max \: float, default 2.*10**-5</span>
<span class="sd">      The maximum of the y_axis. This should be in the same units as were used when creating the ROOT histogram.</span>
<span class="sd">        </span>
<span class="sd">  Attributes</span>
<span class="sd">  ----------</span>
<span class="sd">  figure \: :external:class:`plotly.graph_objects.Figure`</span>
<span class="sd">      A plotly FigureWidget that contains the interactive image.</span>
<span class="sd">  x_max \: float, default 1.</span>
<span class="sd">      The maximum of the x axis, which is typically used for momentum. This should be in the same units as were used when creating the ROOT histogram.</span>
<span class="sd">  y_max \: float, default 2.*10**-5</span>
<span class="sd">      The maximum of the y_axis. This should be in the same units as were used when creating the ROOT histogram.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">image_path</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">x_max</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="mf">2.</span><span class="o">*</span><span class="mi">10</span><span class="o">**-</span><span class="mi">5</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span> <span class="o">=</span> <span class="n">x_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span> <span class="o">=</span> <span class="n">y_max</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span><span class="mi">1000</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cut&#39;</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span><span class="s1">&#39;red&#39;</span><span class="p">})</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This equation is rescaled by 10**&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">image_path</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">add_layout_image</span><span class="p">({</span><span class="s2">&quot;source&quot;</span><span class="p">:</span><span class="n">Image</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">image_path</span><span class="p">),</span><span class="s2">&quot;xref&quot;</span><span class="p">:</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="s2">&quot;yref&quot;</span><span class="p">:</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.125</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">:</span><span class="mf">1.125</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span> <span class="s2">&quot;sizex&quot;</span><span class="p">:</span> <span class="mf">1.25</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span><span class="s2">&quot;sizey&quot;</span><span class="p">:</span><span class="mf">1.25</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span><span class="s2">&quot;sizing&quot;</span><span class="p">:</span><span class="s2">&quot;stretch&quot;</span><span class="p">,</span><span class="s2">&quot;opacity&quot;</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;layer&quot;</span><span class="p">:</span><span class="s2">&quot;below&quot;</span><span class="p">})</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">],</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">],</span><span class="n">showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;plotly_white&quot;</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">530</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">457</span><span class="p">,</span><span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">t</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span><span class="n">pad</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Ionization Energy Loss vs. Momentum&quot;</span><span class="p">,</span> <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;Momentum (GeV/c)&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;dE/dx&quot;</span><span class="p">)</span>
  
<div class="viewcode-block" id="interactive_image.show">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.interactive_image.show">[docs]</a>
  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Shows the interactive image. This is a wrapper method for `plotly.graph_objects.Figure.show &lt;https://plotly.com/python-api-reference/generated/plotly.graph_objects.Figure.html#plotly.graph_objects.Figure.show&gt;`_</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

<div class="viewcode-block" id="interactive_image.update_layout">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.interactive_image.update_layout">[docs]</a>
  <span class="k">def</span> <span class="nf">update_layout</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the layout of the applet. This is a wrapper method for :external:meth:`plotly.graph_objects.Figure.update_layout`. Refer to its documentation for a list of all possible arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="interactive_image.update">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.interactive_image.update">[docs]</a>
  <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates the layout of the applet. This is a wrapper method for :external:meth:`plotly.graph_objects.Figure.update_layout`. Refer to its documentation for a list of all possible arguments.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

  
<div class="viewcode-block" id="interactive_image.display">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.interactive_image.display">[docs]</a>
  <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Displays the sliders for the interactive image. This is done by calling the :meth:`interactive_image.update_figure` method.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    \*\*kwargs:</span>
<span class="sd">        The following keyword arguments correspond to the arguments of the :meth:`interactive_image.update_figure` method. Each of these keyword arguments should be used for every call. Each of these keyword arguments can be assigned one of the following:</span>
<span class="sd">              </span>
<span class="sd">        - A tuple of the form `(min_value, max_value, step)` for numerical (float/int) arguments, which will generate a slider for the argument in question.</span>
<span class="sd">        - A boolean for boolean arguments, which will generate a checkbox, which allows the user to toggle the argument.</span>
<span class="sd">        - A list of strings or tuples, which will produce a dropdown menu of the provided options. If strings, the values in the dropdown will be passed directly to the :meth:`interactive_image.update_figure` method. If a list of tuples is passed, they should be of the form (label, value), where the dropdown options are the &quot;labels&quot;, and the corresponding value to be passed to :meth:`interactive_image.update_figure` is the &quot;value&quot;.</span>
<span class="sd">        - An instance of `ipywidgets.widgets.interaction.fixed &lt;https://ipywidgets.readthedocs.io/en/stable/reference/ipywidgets.html#ipywidgets.widgets.interaction.fixed&gt;`_, which represents that the provided value cannot be changed by the user. No widget will be generated for this argument.</span>
<span class="sd">            </span>
<span class="sd">        The below list of keyword arguments specifies the expected type of the arguments. Note that these correspond to the constants in the equation y= exp(a*p+b)+c. Also note that the y axis is automatically rescaled, and the rescaling factor will be printed out when initializing the image.</span>
<span class="sd">        </span>
<span class="sd">        a \: numerical</span>
<span class="sd">            The exponential decay constant of the exponential function (e**(-a*p)).</span>
<span class="sd">        b \: numerical</span>
<span class="sd">            A vertical rescaling factor for the exponential function (by a factor of e**b).</span>
<span class="sd">        c \: numerical</span>
<span class="sd">            The vertical offset of the exponential function.</span>

<span class="sd">    Examples:</span>
<span class="sd">    -----------</span>
<span class="sd">    &gt;&gt;&gt; fig = interactive_image()</span>
<span class="sd">    &gt;&gt;&gt; fig.update()</span>
<span class="sd">    &gt;&gt;&gt; fig.display(a=(-10,-1, 0.1), b=(0,10,0.1), c=fixed(1))</span>

<span class="sd">    The result of this code is a plot with a slider that allows the user to modify the values of a and b. The value of c will be fixed, so no slider will be displayed.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widget</span><span class="o">=</span><span class="n">interactive</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_figure</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">controls</span> <span class="o">=</span> <span class="n">HBox</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">children</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">layout</span> <span class="o">=</span> <span class="n">Layout</span><span class="p">(</span><span class="n">flex_flow</span><span class="o">=</span><span class="s1">&#39;row wrap&#39;</span><span class="p">))</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">children</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">display</span><span class="p">(</span><span class="n">VBox</span><span class="p">([</span><span class="n">controls</span><span class="p">,</span> <span class="n">output</span><span class="p">]))</span></div>


<div class="viewcode-block" id="interactive_image.update_figure">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.interactive_image.update_figure">[docs]</a>
  <span class="k">def</span> <span class="nf">update_figure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Updates and draws the interactive image, recalculating exponential equation y= exp(a*p+b)+c.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    a \: numerical</span>
<span class="sd">        The exponential decay constant of the exponential function (e**(-a*p)).</span>
<span class="sd">    b \: numerical</span>
<span class="sd">        A vertical rescaling factor for the exponential function (by a factor of e**b).</span>
<span class="sd">    c \: numerical</span>
<span class="sd">        The vertical offset of the exponential function.</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">batch_update</span><span class="p">():</span>
      <span class="bp">self</span><span class="o">.</span><span class="n">figure</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">y_max</span><span class="p">,</span><span class="mi">10</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">x_max</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span><span class="o">+</span><span class="n">b</span><span class="p">)</span><span class="o">+</span><span class="n">c</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="BCal_plot_2D">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.BCal_plot_2D">[docs]</a>
<span class="k">def</span> <span class="nf">BCal_plot_2D</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Displays a 2D plot of the modules of the Barrel Calorimeter (BCal).</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">module_points</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">)}</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">65</span>
  <span class="n">outer_radius</span> <span class="o">=</span> <span class="mf">87.46</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">65</span>
  <span class="n">inner_module_width</span> <span class="o">=</span> <span class="mf">8.52</span>
  <span class="n">outer_module_width</span> <span class="o">=</span> <span class="mf">11.46</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">yaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
    <span class="n">inner_radius_vector</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
    <span class="n">outer_radius_vector</span> <span class="o">=</span> <span class="n">outer_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">+</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_radius_vector</span> <span class="o">-</span> <span class="n">outer_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_radius_vector</span> <span class="o">+</span> <span class="n">outer_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">+</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">module_points</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)],</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Module &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">)</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="BCal_plot_3D">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.BCal_plot_3D">[docs]</a>
<span class="k">def</span> <span class="nf">BCal_plot_3D</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Displays a 3D model of the modules of the Barrel Calorimeter (BCal).</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="n">module_points</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:[]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">)}</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">65</span>
  <span class="n">outer_radius</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">+</span> <span class="mf">22.46</span>
  <span class="n">inner_module_width</span> <span class="o">=</span> <span class="mf">8.52</span>
  <span class="n">outer_module_width</span> <span class="o">=</span> <span class="mf">11.46</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">scene</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xaxis_title&quot;</span><span class="p">:</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="s2">&quot;yaxis_title&quot;</span><span class="p">:</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;zaxis_title&#39;</span><span class="p">:</span><span class="s1">&#39;Y&#39;</span><span class="p">})</span>
  <span class="k">for</span> <span class="n">module</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">48</span><span class="p">):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">module</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span>
    <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">inner_radius_vector</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">outer_radius_vector</span> <span class="o">=</span> <span class="n">outer_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">+</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_radius_vector</span> <span class="o">-</span> <span class="n">outer_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_radius_vector</span> <span class="o">+</span> <span class="n">outer_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span><span class="p">)</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">+</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">390</span><span class="p">]))</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">390</span><span class="p">]))</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_radius_vector</span> <span class="o">-</span> <span class="n">outer_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">390</span><span class="p">]))</span>
    <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">outer_radius_vector</span> <span class="o">+</span> <span class="n">outer_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">390</span><span class="p">]))</span>
    <span class="n">i</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">j</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Mesh3d</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]],</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]],</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">pt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">module_points</span><span class="p">[</span><span class="n">module</span><span class="p">]],</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Module &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">flatshading</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="o">=</span><span class="n">j</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">,</span><span class="n">hovertemplate</span><span class="o">=</span><span class="s2">&quot;Module &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">module</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;&lt;extra&gt;&lt;/extra&gt;&quot;</span><span class="p">))</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="BCal_module">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.BCal_module">[docs]</a>
<span class="k">def</span> <span class="nf">BCal_module</span><span class="p">():</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Displays a 2D model of a single Barrel Calorimeter (BCal) module, showing sector and layer segmentations.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">calculate_x</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sector</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">8.51</span><span class="o">*</span><span class="n">sector</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.475</span><span class="o">*</span><span class="p">(</span><span class="n">sector</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">layer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span>
  <span class="k">def</span> <span class="nf">calculate_y</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sector</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">22.46</span><span class="o">*</span><span class="p">((</span><span class="n">layer</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">layer</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span><span class="mi">10</span><span class="p">],</span> <span class="n">yaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">25</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">,</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="n">scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
  <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">sector</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
      <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">calculate_x</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sector</span><span class="p">),</span><span class="n">calculate_x</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sector</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">calculate_x</span><span class="p">(</span><span class="n">layer</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sector</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">calculate_x</span><span class="p">(</span><span class="n">layer</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sector</span><span class="p">)],</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">calculate_y</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sector</span><span class="p">),</span><span class="n">calculate_y</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span><span class="n">sector</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">calculate_y</span><span class="p">(</span><span class="n">layer</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sector</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">calculate_y</span><span class="p">(</span><span class="n">layer</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">sector</span><span class="p">)],</span><span class="n">fill</span><span class="o">=</span><span class="s2">&quot;toself&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Layer: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, Sector: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sector</span><span class="p">),</span><span class="n">hoverinfo</span><span class="o">=</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
      <span class="n">fig</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>



<div class="viewcode-block" id="view_shower_2D">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.view_shower_2D">[docs]</a>
<span class="k">def</span> <span class="nf">view_shower_2D</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">eventNum</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates a displays a 2D visualization of the BCal shower in the provided row of the provided dataframe.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  -----------</span>
<span class="sd">  df \: :external:class:`pandas.DataFrame`</span>
<span class="sd">      The dataframe containing events in the GlueX BCal. This dataframe should have 7 columns: &quot;module&quot;,&quot;sector&quot;, &quot;layer&quot;, &quot;pulse_integral_up&quot;, &quot;pulse_integral_down&quot;, &quot;t_up&quot;, and &quot;t_down&quot;. Each of these columns should contain a list, and all of these lists should be the same length across columns. Each element of each list corresponds to a single hit in the BCal.</span>
<span class="sd">  eventNum \: int</span>
<span class="sd">      The row of the dataframe for which you want to plot the shower.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">closest_hit</span><span class="p">(</span><span class="n">prev_layer</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">prev_distance</span> <span class="o">=</span> <span class="mi">10000000</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">prev_layer</span><span class="o">.</span><span class="n">iloc</span><span class="p">:</span>
      <span class="n">distance</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
      <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">prev_distance</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
        <span class="n">prev_distance</span> <span class="o">=</span> <span class="n">distance</span>
    <span class="k">if</span> <span class="n">prev_distance</span> <span class="o">&gt;</span> <span class="p">((</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">solution</span>
  <span class="n">event</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">eventNum</span><span class="p">]</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">65</span>
  <span class="n">outer_radius</span> <span class="o">=</span> <span class="mf">87.46</span>
  <span class="n">inner_module_width</span> <span class="o">=</span> <span class="mf">8.52</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">yaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
  <span class="n">points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:[],</span><span class="s1">&#39;y&#39;</span><span class="p">:[],</span><span class="s1">&#39;z&#39;</span><span class="p">:[]}</span>
  <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">])):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">unit_radius_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
    <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
    <span class="n">inner_radius_vector</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">unit_vector</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.51</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.475</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">position</span> <span class="o">+=</span> <span class="mf">22.46</span><span class="o">*</span><span class="p">((</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span> <span class="o">*</span><span class="n">unit_radius_vector</span>
    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="o">*</span><span class="mf">16.75</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;t_up&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;t_down&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">130000</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;pulse_integral_up&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="mi">525</span><span class="p">)</span><span class="o">+</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;pulse_integral_down&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">390</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="mi">525</span><span class="p">)))</span>
  <span class="n">each_hit_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.75</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span><span class="o">+</span><span class="mf">0.25</span>
  <span class="n">opacities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span>
  <span class="n">previous_layer_hits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">layer_hits</span> <span class="o">=</span> <span class="n">each_hit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">previous_layer_hits</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer_hits</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">layer_hits</span><span class="o">.</span><span class="n">iloc</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">hit</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">unit_radius_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
        <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
        <span class="n">inner_radius_vector</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">unit_vector</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.51</span><span class="o">*</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.475</span><span class="o">*</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">+=</span> <span class="mf">22.46</span><span class="o">*</span><span class="p">((</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span> <span class="o">*</span><span class="n">unit_radius_vector</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y2</span><span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span> <span class="o">=</span> <span class="n">closest_hit</span><span class="p">(</span><span class="n">each_hit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">i</span><span class="p">],</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span><span class="n">x0</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span><span class="n">y0</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span><span class="n">x1</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span><span class="n">y1</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span><span class="n">opacity</span><span class="o">=</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">],</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;#636EFA&quot;</span><span class="p">)</span>
    <span class="n">previous_layer_hits</span> <span class="o">=</span> <span class="n">layer_hits</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="n">points</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span><span class="n">marker</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;opacity&#39;</span><span class="p">:</span><span class="n">opacities</span><span class="p">})</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">inner_radius</span><span class="p">,</span> <span class="n">y0</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">inner_radius</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">inner_radius</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">inner_radius</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">&quot;circle&quot;</span><span class="p">,</span> <span class="n">xref</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yref</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">x0</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">outer_radius</span><span class="p">,</span> <span class="n">y0</span><span class="o">=-</span><span class="mi">1</span><span class="o">*</span><span class="n">outer_radius</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">outer_radius</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">outer_radius</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">)</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<div class="viewcode-block" id="view_shower_3D">
<a class="viewcode-back" href="../../index.html#pidp_tools.visualization.view_shower_3D">[docs]</a>
<span class="k">def</span> <span class="nf">view_shower_3D</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">eventNum</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">  Creates a displays a 3D visualization of the BCal shower in the provided row of the provided dataframe.</span>

<span class="sd">  Parameters:</span>
<span class="sd">  -----------</span>
<span class="sd">  df \: :external:class:`pandas.DataFrame`</span>
<span class="sd">      The dataframe containing events in the GlueX BCal. This dataframe should have 7 columns: &quot;module&quot;,&quot;sector&quot;, &quot;layer&quot;, &quot;pulse_integral_up&quot;, &quot;pulse_integral_down&quot;, &quot;t_up&quot;, and &quot;t_down&quot;. Each of these columns should contain a list, and all of these lists should be the same length across columns. Each element of each list corresponds to a single hit in the BCal.</span>
<span class="sd">  eventNum \: int</span>
<span class="sd">      The row of the dataframe for which you want to plot the shower.</span>

<span class="sd">  &quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="nf">closest_hit</span><span class="p">(</span><span class="n">prev_layer</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">):</span>
    <span class="n">prev_distance</span> <span class="o">=</span> <span class="mi">10000000</span>
    <span class="n">solution</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">prev_layer</span><span class="o">.</span><span class="n">iloc</span><span class="p">:</span>
      <span class="n">distance</span> <span class="o">=</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">z</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
      <span class="k">if</span> <span class="n">distance</span> <span class="o">&lt;</span> <span class="n">prev_distance</span><span class="p">:</span>
        <span class="n">solution</span> <span class="o">=</span> <span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">])</span>
        <span class="n">prev_distance</span> <span class="o">=</span> <span class="n">distance</span>
    <span class="k">if</span> <span class="n">prev_distance</span> <span class="o">&gt;</span> <span class="p">((</span><span class="mi">2</span><span class="o">*</span><span class="n">x</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">y</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">:</span>
      <span class="k">return</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">return</span> <span class="n">solution</span>
  <span class="n">event</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">eventNum</span><span class="p">]</span>
  <span class="n">inner_radius</span> <span class="o">=</span> <span class="mi">65</span>
  <span class="n">inner_module_width</span> <span class="o">=</span> <span class="mf">8.52</span>
  <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">FigureWidget</span><span class="p">()</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">xaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span> <span class="n">yaxis_range</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">width</span><span class="o">=</span><span class="mi">520</span><span class="p">,</span><span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span><span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
  <span class="n">points</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;x&#39;</span><span class="p">:[],</span><span class="s1">&#39;y&#39;</span><span class="p">:[],</span><span class="s1">&#39;z&#39;</span><span class="p">:[]}</span>
  <span class="n">energies</span> <span class="o">=</span> <span class="p">[]</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">])):</span>
    <span class="n">angle</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">unit_radius_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
    <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
    <span class="n">inner_radius_vector</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
    <span class="n">origin</span> <span class="o">=</span> <span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span>
    <span class="n">position</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">unit_vector</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.51</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.475</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">position</span> <span class="o">+=</span> <span class="mf">22.46</span><span class="o">*</span><span class="p">((</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span> <span class="o">*</span><span class="n">unit_radius_vector</span>
    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="mi">30</span><span class="o">*</span><span class="mf">16.75</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;t_up&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;t_down&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="n">points</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">energies</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="mi">130000</span><span class="o">*</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;pulse_integral_up&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="mi">525</span><span class="p">)</span><span class="o">+</span><span class="n">event</span><span class="p">[</span><span class="s1">&#39;pulse_integral_down&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="mi">390</span><span class="o">-</span><span class="n">z</span><span class="p">)</span><span class="o">/</span><span class="mi">525</span><span class="p">)))</span>
  <span class="n">each_hit_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;E&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">energies</span>
  <span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">energies</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">energies</span><span class="p">))</span><span class="o">+</span><span class="mf">0.5</span>
  <span class="n">previous_layer_hits</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">layer_hits</span> <span class="o">=</span> <span class="n">each_hit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">==</span><span class="n">i</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">previous_layer_hits</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">layer_hits</span><span class="o">.</span><span class="n">index</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">layer_hits</span><span class="o">.</span><span class="n">iloc</span><span class="p">:</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">hit</span><span class="p">[</span><span class="s1">&#39;module&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">unit_radius_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
        <span class="n">unit_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)])</span>
        <span class="n">inner_radius_vector</span> <span class="o">=</span> <span class="n">inner_radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">)])</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="n">inner_radius_vector</span> <span class="o">-</span> <span class="n">inner_module_width</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">unit_vector</span>
        <span class="n">position</span> <span class="o">=</span> <span class="n">origin</span> <span class="o">+</span> <span class="n">unit_vector</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.51</span><span class="o">*</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">4</span> <span class="o">+</span> <span class="mf">1.475</span><span class="o">*</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;sector&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="p">((</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span><span class="p">)</span>
        <span class="n">position</span> <span class="o">+=</span> <span class="mf">22.46</span><span class="o">*</span><span class="p">((</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">-</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="mi">20</span> <span class="o">*</span><span class="n">unit_radius_vector</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y2</span><span class="o">=</span> <span class="n">position</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">z2</span> <span class="o">=</span> <span class="n">hit</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">]</span>
        <span class="n">x1</span><span class="p">,</span><span class="n">y1</span><span class="p">,</span><span class="n">z1</span> <span class="o">=</span> <span class="n">closest_hit</span><span class="p">(</span><span class="n">each_hit_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">each_hit_df</span><span class="p">[</span><span class="s1">&#39;layer&#39;</span><span class="p">]</span><span class="o">&lt;</span><span class="n">i</span><span class="p">],</span><span class="n">x2</span><span class="p">,</span><span class="n">y2</span><span class="p">,</span><span class="n">z2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_scatter3d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">],</span><span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">y1</span><span class="p">,</span><span class="n">y2</span><span class="p">],</span><span class="n">z</span><span class="o">=</span><span class="p">[</span><span class="n">z1</span><span class="p">,</span><span class="n">z2</span><span class="p">],</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span><span class="n">line</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span><span class="s2">&quot;rgba(99,110,250,&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">hit</span><span class="p">[</span><span class="s1">&#39;opacity&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">,</span><span class="s1">&#39;width&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">})</span>
    <span class="n">previous_layer_hits</span> <span class="o">=</span> <span class="n">layer_hits</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
  <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Richard Dube.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>